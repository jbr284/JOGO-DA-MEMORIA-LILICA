<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Velha (Online)</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192.png" type="image/png">
    <meta name="theme-color" content="#16213e">

    <style>
        /* CSS (sem alterações) */
        :root{--bg-color:#1a1a2e;--board-bg-color:#16213e;--cell-bg-color:#0f3460;--text-color:#e94560;--accent-color:#fff;--player1-color:#53a8b6;--player2-color:#e94560;--win-line-color:#f5f542}body{font-family:Arial,sans-serif;background-color:var(--bg-color);color:var(--accent-color);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;margin:0}h1{color:var(--text-color);margin-bottom:10px}.game-info{display:flex;justify-content:space-between;width:300px;margin-bottom:20px;font-size:1.1em}.player-score{padding:8px 15px;border-radius:8px;font-weight:700;transition:all .3s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:45%}#player1-info{background-color:var(--player1-color)}#player2-info{background-color:var(--player2-color)}.player-score.active{box-shadow:0 0 15px var(--accent-color);transform:scale(1.05)}#turn-info{width:100%;text-align:center;font-size:1.5em;margin-bottom:20px;font-weight:700;min-height:1.5em}.game-board{display:grid;grid-template-columns:repeat(3,100px);grid-template-rows:repeat(3,100px);gap:5px;background-color:var(--board-bg-color);padding:10px;border-radius:10px;position:relative}.cell{background-color:var(--cell-bg-color);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:60px;font-weight:700;cursor:pointer;transition:background-color .3s}.cell:not(.X):not(.O):hover{background-color:#1f4a81}.cell.X{color:var(--player1-color);cursor:default}.cell.O{color:var(--player2-color);cursor:default}.win-line{position:absolute;background-color:var(--win-line-color);border-radius:5px;box-shadow:0 0 10px var(--win-line-color)}#reset-button{margin-top:25px;padding:12px 25px;font-size:1em;font-weight:700;color:var(--accent-color);background-color:var(--text-color);border:none;border-radius:8px;cursor:pointer}#game-id-display{font-size:.9em;color:var(--accent-color);margin-top:15px;opacity:.7}
    </style>
</head>
<body>

    <h1>Jogo da Velha Online</h1>

    <div class="game-info">
        <div id="player1-info" class="player-score">X (P1): 0</div>
        <div id="player2-info" class="player-score">O (P2): 0</div>
    </div>

    <div id="turn-info">Conectando...</div>

    <div class="game-board" id="game-board">
        </div>

    <button id="reset-button">Voltar ao Lobby</button>
    <div id="game-id-display"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        // Sua configuração do Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyCLAsfQdpaEzk_5IFV39F0m_IyaFsGbAbc",
          authDomain: "jogo-da-memoria-lilica.firebaseapp.com",
          databaseURL: "https://jogo-da-memoria-lilica-default-rtdb.firebaseio.com",
          projectId: "jogo-da-memoria-lilica",
          storageBucket: "jogo-da-memoria-lilica.firebasestorage.app",
          messagingSenderId: "683788488529",
          appId: "1:683788488529:web:727316a3e182257a2d8d70"
        };

        // Inicializar o Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        document.addEventListener('DOMContentLoaded', () => {
            const gameBoard = document.getElementById('game-board');
            const player1InfoEl = document.getElementById('player1-info');
            const player2InfoEl = document.getElementById('player2-info');
            const turnInfoEl = document.getElementById('turn-info');
            const resetButton = document.getElementById('reset-button');
            const gameIdDisplay = document.getElementById('game-id-display');

            let gameStateRef;
            let gameId;
            let playerId;
            let myPlayerUUID;
            let playerNames = { 1: "Jogador 1", 2: "Jogador 2" };

            // --- FUNÇÃO DE INICIALIZAÇÃO ---
            function initGame() { /* ... (código igual à versão anterior) ... */ }

            // --- Função: "Ouvir" as mudanças do Jogo no Firebase ---
            function setupGameListeners() { /* ... (código igual à versão anterior) ... */ }

            // --- Função: Renderizar o Tabuleiro (CORRIGIDA) ---
            function renderBoard(boardState, winnerInfo) {
                 console.log("renderBoard chamado com board:", boardState);
                 gameBoard.innerHTML = '';
                 const oldWinLine = gameBoard.querySelector('.win-line');
                 if (oldWinLine) oldWinLine.remove();

                 if (!Array.isArray(boardState)) {
                     console.error("renderBoard Erro: boardState não é um array!", boardState);
                     turnInfoEl.textContent = "Erro ao carregar tabuleiro!";
                     // Tenta criar um board vazio para evitar que a UI fique totalmente quebrada
                     boardState = Array(9).fill(null); 
                 }

                 // *** INÍCIO DA CORREÇÃO: Cria as células diretamente ***
                 boardState.forEach((cellValue, index) => {
                     const cell = document.createElement('div');
                     cell.classList.add('cell');
                     cell.dataset.index = index;
                     if (cellValue) {
                         cell.textContent = cellValue;
                         cell.classList.add(cellValue);
                         cell.style.cursor = 'default';
                     } else if (winnerInfo === undefined || winnerInfo === null) {
                         cell.addEventListener('click', () => onCellClick(index));
                     } else {
                          cell.style.cursor = 'default';
                     }
                     gameBoard.appendChild(cell);
                 });
                 // *** FIM DA CORREÇÃO ***

                 if (winnerInfo) { drawWinLine(winnerInfo); }
            }


            // --- Função: Lógica do Clique na Célula ---
            function onCellClick(index) { /* ... (código igual à versão anterior) ... */ }

            // --- Função: Verificar Vitória ou Empate ---
            function checkForWinner(board) { /* ... (código igual à versão anterior) ... */ }

            // --- Função: Desenha a linha de vitória ---
             function drawWinLine(winnerInfo) { /* ... (código igual à versão anterior) ... */ }

            // --- Função: Atualizar Placar ---
            function updateScoreboard(scores) { /* ... (código igual à versão anterior) ... */ }

            // --- Função: Atualizar Info de Turno e Fim de Jogo ---
            function updateTurnInfo(currentPlayer, winner, player2_uuid) { /* ... (código igual à versão anterior) ... */ }

            // --- Event Listeners ---
            resetButton.addEventListener('click', () => { /* ... (código igual à versão anterior) ... */ });

            // --- Inicia o Jogo ---
            initGame();
        });
    </script>
</body>
</html>
